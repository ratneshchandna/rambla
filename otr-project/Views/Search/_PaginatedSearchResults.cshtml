@model PagedList<otr_project.ViewModels.SearchItemViewModel>
@using Webdiyer.WebControls.Mvc;

<div id="searchResults">
@if (Model.Count() == 0)
{
    <div class="row-fluid">
        <h3>Your search yeilded no results.</h3>
    </div>
}
else
{
    @Ajax.Pager((IPagedList)Model, new PagerOptions { PageIndexParameterName = "id", ShowDisabledPagerItems = false, SeparatorHtml = "&nbsp;|&nbsp;" }, new AjaxOptions { UpdateTargetId = "dvOrders" }, new { id = "pagination" })
    for (int i=0; i<Model.Count(); i+=4)
    {
        <div class="row-fluid">
            <ul class="thumbnails">
                @for (int j=0; j<4; j++)
                {
                    if (i+j >= Model.Count()){
                        break;   
                    }
                    var searchItem = Model[i+j];
                    if (searchItem == null) 
                    {
                        break;
                    }
                
                    <li class="span3 max-height-limit">
                        <div class="thumbnail">
                            <div class="row-fluid">
                                <div class="span12 search-price-banner vcenter">
                                    <div class="span8 tpad10 hpad5">
                                        @searchItem.Item.Name
                                    </div>
                                    <div class="span4">
                                        <h3>@searchItem.Item.CostPerDay.ToString("C")</h3>
                                    </div>
                                </div>
                            </div>
                            @if (j == 1){
                            <div class="row-fluid">
                                <div class="span12 item-conflict-banner">
                                    Item not available for selected dates.
                                </div>
                            </div>
                                }
                            @if (searchItem.Item.ItemImages.Count > 0)
                            {
                                <img class="search-thumbnail-image" src="@Url.Content("~/Item/GetItemImage/" + searchItem.Item.ItemImages.ElementAt(0).Id)" />
                            }
                            else
                            {
                                <img class="search-thumbnail-image" src="@Url.Content("~/Content/images/default_item_image.jpg")" />
                            }
                            <h5>@searchItem.Item.Owner.FirstName @searchItem.Item.Owner.LastName</h5>
                            <p><strong>@searchItem.Item.PickupLocation.City, @searchItem.Item.ItemRegion.Name</strong></p>
                            <ul class="nav nav-pills no-margin">
                                <li>
                                    <i class="icon-star"></i>
                                    <i class="icon-star"></i>
                                    <i class="icon-star"></i>
                                    <i class="icon-star"></i>
                                    <i class="icon-star"></i>
                                </li>
                            </ul>
                        </div>
                    </li>
                }
            </ul>
        </div>   
    }
    foreach (var searchItem in Model)
    {
        <tr id="@searchItem.Item.Id" class="search_result" onclick="document.location='@Url.Content("~/Item/Details/" + searchItem.Item.Id)';">
            <td class="search_item_image">
                <!--div class="item_image_small"-->
                @{
                    
                }
                <!--/div-->
            </td>
            <td class="search_item_details">
                <div id="Search_Item_Name">
                    @Html.ActionLink(searchItem.Item.Name, "Details", "Item", new { id = searchItem.Item.Id }, null)
                </div>
                @if(searchItem.isItemBlocked)
                {
                    <div id="ItemIsBlocked">
                        This item is booked on one or more days between 
                        @DateTime.Parse(Session["SEARCH_PICKUP"].ToString()).ToLongDateString() & 
                        @DateTime.Parse(Session["SEARCH_DROPOFF"].ToString()).ToLongDateString()
                    </div>
                }
                <br />
                <!--div id="Search_Item_Description">
                    @searchItem.Item.Desc
                </div-->
                Location: 
                <div class="search_item_city_province">
                    @searchItem.Item.PickupLocation.City, @searchItem.Item.ItemRegion.Name
                </div>
            </td>
            <td class="search_item_owner_image">
                @if (searchItem.Item.Owner != null)
                {
                    if (searchItem.Item.Owner.isFacebookUser)
                    {
                        <img class="Search_Owner_Image" src="https://graph.facebook.com/@searchItem.Item.Owner.FacebookProfile.Id/picture?type=small" />
                    }
                    else
                    {
                        if (searchItem.Item.Owner.ProfilePicture != null)
                        {
                            string id = searchItem.Item.Id;
                            <img class="Search_Owner_Image" src="@Url.Content("~/User/GetProfilePicture/" + id)" />
                        }
                        else
                        {
                            <img class="Search_Owner_Image" src="@Url.Content("~/Content/images/empty_profile_picture.png")" />
                        }
                    }
                    <div class="search_item_owner">
                        @(searchItem.Item.Owner.FirstName + " " + searchItem.Item.Owner.LastName)
                    </div>
                }
            </td>
            <td class="search_item_price">
                <div id="Search_Item_PricePerDay">
                    <div class="search_item_price_amount">
                        @searchItem.Item.CostPerDay.ToString("C")
                    </div>
                    <span class="price_per_day">per day</span>
                </div>
            </td>
        </tr>
    }
}
</div>